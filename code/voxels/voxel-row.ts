// ********************************************************************************************************************
import { GeometryBuilder } from "../geometry/geometry-builder";
// ********************************************************************************************************************
import { Bounds3 } from "../types/bounds3";
// ********************************************************************************************************************
import { Vector3 } from "../types/vector3";
// ********************************************************************************************************************
import { VoxelArray } from "./voxel-array";
// ********************************************************************************************************************
export class VoxelQuadRow extends VoxelArray<boolean> {

    // ****************************************************************************************************************
    // constructor
    // ****************************************************************************************************************
    constructor(size: number) { super(size); }

    // ****************************************************************************************************************
    // function:    createElement
    // ****************************************************************************************************************
    // parameters:  n/a
    // ****************************************************************************************************************
    // returns:     the element
    // ****************************************************************************************************************
    protected override createElement(): boolean { return true; }

    // ****************************************************************************************************************
    // function:    createGeometry
    // ****************************************************************************************************************
    // parameters:  builder - the builder
    // ****************************************************************************************************************
    //              bounds - the bounds
    // ****************************************************************************************************************
    // returns:     n/a
    // ****************************************************************************************************************
    public createGeometry(builder: GeometryBuilder, bounds: Bounds3): void {

        if (this.getVoxels()) {

            builder.addCubeFromBounds(bounds);

        } else if (this.elements.length) {

            for (var index = 0; index < this.size; index++) {

                if (this.elements[index]) {

                    const min = new Vector3(bounds.min.x, bounds.min.y, bounds.min.z + index - 0.5);

                    const max = new Vector3(bounds.max.x, bounds.max.y, bounds.min.z + index + 0.5);

                    builder.addCubeFromBounds(new Bounds3(min, max));
                }
            }
        }
    }

    // ****************************************************************************************************************
    // function:    getVoxel
    // ****************************************************************************************************************
    // parameters:  index - the index
    // ****************************************************************************************************************
    // returns:     the voxel
    // ****************************************************************************************************************
    public getVoxel(index: number): boolean {

        return this.get(index, true) ?? false;
    }

    // ****************************************************************************************************************
    // function:    getVoxels
    // ****************************************************************************************************************
    // parameters:  n/a
    // ****************************************************************************************************************
    // returns:     the voxels
    // ****************************************************************************************************************
    public getVoxels(): boolean {

        return this.elements.length > 0 && this.elements.every(el => el === true);
    }

    // ****************************************************************************************************************
    // function:    setVoxel
    // ****************************************************************************************************************
    // parameters:  index - the index
    // ****************************************************************************************************************
    //              voxel - the voxel
    // ****************************************************************************************************************
    // returns:     whether changed
    // ****************************************************************************************************************
    public setVoxel(index: number, voxel: boolean): boolean {

        return this.set(index, voxel);
    }

    // ****************************************************************************************************************
    // function:    setVoxels
    // ****************************************************************************************************************
    // parameters:  voxel - the voxel
    // ****************************************************************************************************************
    // returns:     whether changed
    // ****************************************************************************************************************
    public setVoxels(voxel: boolean): boolean {

        return this.fill(voxel);
    }
}
